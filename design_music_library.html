<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacMusicPlayer 多音乐库功能设计文档 MacMusicPlayer</title>
    <meta name="description" content="当前 MacMusicPlayer 仅支持从单一文件夹加载音乐文件，不支持管理多个音乐库和播放列表。本设计旨在扩展应用功能，使其支持：">
    <meta name="keywords" content="macOS, music player, menu bar, SwiftUI, seamless,macOS Integration, exceptional, user experience, Minimalist Design,Audio Player">
    <link rel="stylesheet" type="text/css" href="css/main.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/tocbot.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/media.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/copy.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/demo-preview.css?v=1.34.1">
    <script src="js/copy.js?v=1.34.1"></script>
    <script src="js/dark-mode.js?v=1.34.1"></script>
    <script src="js/markdown-style.js?v=1.34.1"></script>
  </head>
  <body id="idoctotop"><a href="#idoctotop" class="gototop">top</a>
    <header class="header">
      <article class="inner warpper" style="max-width:720px;"><a class="logo" href="index.html"><span class="title">MacMusicPlayer</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="index.html" target="" class="">Home</a></li>
            <li><a href="https://github.com/samzong" target="__blank" class="">About</a></li>
          </ul><a href="https://github.com/samzong/MacMusicPlayer" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div style="max-width:720px;" class="warpper-content warpper notocs">
      <markdown-style theme-auto-switch-disabled="">
        <h1 id="macmusicplayer-多音乐库功能设计文档"><a aria-hidden="true" tabindex="-1" href="#macmusicplayer-多音乐库功能设计文档" class="anchor"><span class="icon icon-link"></span></a>MacMusicPlayer 多音乐库功能设计文档</h1>
        <h2 id="1-功能概述"><a aria-hidden="true" tabindex="-1" href="#1-功能概述" class="anchor"><span class="icon icon-link"></span></a>1. 功能概述</h2>
        <p>当前 MacMusicPlayer 仅支持从单一文件夹加载音乐文件，不支持管理多个音乐库和播放列表。本设计旨在扩展应用功能，使其支持：</p>
        <ul>
          <li>添加、删除和管理多个音乐库</li>
          <li>在不同音乐库之间快速切换</li>
          <li>为每个音乐库创建自定义名称</li>
        </ul>
        <h2 id="2-设计方案"><a aria-hidden="true" tabindex="-1" href="#2-设计方案" class="anchor"><span class="icon icon-link"></span></a>2. 设计方案</h2>
        <h3 id="21-核心组件扩展"><a aria-hidden="true" tabindex="-1" href="#21-核心组件扩展" class="anchor"><span class="icon icon-link"></span></a>2.1 核心组件扩展</h3>
        <h4 id="新增模型musiclibrary"><a aria-hidden="true" tabindex="-1" href="#新增模型musiclibrary" class="anchor"><span class="icon icon-link"></span></a>新增模型：MusicLibrary</h4>
        <p>创建一个新的模型来表示音乐库：</p>
        <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">struct</span> <span class="token class-name">MusicLibrary</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span><span class="token punctuation">,</span> <span class="token class-name">Codable</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token constant">UUID</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">var</span> path<span class="token punctuation">:</span> <span class="token class-name">String</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">var</span> createdAt<span class="token punctuation">:</span> <span class="token class-name">Date</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">var</span> lastAccessed<span class="token punctuation">:</span> <span class="token class-name">Date</span>
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="struct MusicLibrary: Identifiable, Codable {
    let id: UUID
    var name: String
    var path: String
    var createdAt: Date
    var lastAccessed: Date
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="librarymanager"><a aria-hidden="true" tabindex="-1" href="#librarymanager" class="anchor"><span class="icon icon-link"></span></a>LibraryManager</h4>
        <p>新增一个管理器组件负责音乐库管理：</p>
        <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">class</span> <span class="token class-name">LibraryManager</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> libraries<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">MusicLibrary</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="3">    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> currentLibrary<span class="token punctuation">:</span> <span class="token class-name">MusicLibrary</span><span class="token operator">?</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token keyword">func</span> <span class="token function-definition function">addLibrary</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">func</span> <span class="token function-definition function">removeLibrary</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token constant">UUID</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">func</span> <span class="token function-definition function">switchLibrary</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token constant">UUID</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">func</span> <span class="token function-definition function">saveLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">    <span class="token keyword">func</span> <span class="token function-definition function">loadLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="class LibraryManager: ObservableObject {
    @Published var libraries: [MusicLibrary]
    @Published var currentLibrary: MusicLibrary?

    func addLibrary(name: String, path: String)
    func removeLibrary(id: UUID)
    func switchLibrary(id: UUID)
    func saveLibraries()
    func loadLibraries()
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="扩展-playermanager"><a aria-hidden="true" tabindex="-1" href="#扩展-playermanager" class="anchor"><span class="icon icon-link"></span></a>扩展 PlayerManager</h4>
        <p>扩展 PlayerManager 以支持音乐库切换：</p>
        <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">extension</span> <span class="token class-name">PlayerManager</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">func</span> <span class="token function-definition function">loadLibrary</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> library<span class="token punctuation">:</span> <span class="token class-name">MusicLibrary</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="extension PlayerManager {
    func loadLibrary(_ library: MusicLibrary)
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="22-持久化存储"><a aria-hidden="true" tabindex="-1" href="#22-持久化存储" class="anchor"><span class="icon icon-link"></span></a>2.2 持久化存储</h3>
        <p>使用 UserDefaults 或 FileManager 存储音乐库信息：</p>
        <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">saveLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">do</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>libraries<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">        <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"MusicLibraries"</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Failed to save libraries: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="8"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">loadLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">guard</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"MusicLibraries"</span></span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token keyword">return</span>
</span><span class="code-line line-number" line="13">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">
</span><span class="code-line line-number" line="15">    <span class="token keyword">do</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="16">        libraries <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">MusicLibrary</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="17">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Failed to load libraries: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="20"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="private func saveLibraries() {
    do {
        let data = try JSONEncoder().encode(libraries)
        UserDefaults.standard.set(data, forKey: &#x22;MusicLibraries&#x22;)
    } catch {
        print(&#x22;Failed to save libraries: \(error)&#x22;)
    }
}

private func loadLibraries() {
    guard let data = UserDefaults.standard.data(forKey: &#x22;MusicLibraries&#x22;) else {
        return
    }

    do {
        libraries = try JSONDecoder().decode([MusicLibrary].self, from: data)
    } catch {
        print(&#x22;Failed to load libraries: \(error)&#x22;)
    }
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="3-ui-变更"><a aria-hidden="true" tabindex="-1" href="#3-ui-变更" class="anchor"><span class="icon icon-link"></span></a>3. UI 变更</h2>
        <h3 id="31-菜单栏扩展"><a aria-hidden="true" tabindex="-1" href="#31-菜单栏扩展" class="anchor"><span class="icon icon-link"></span></a>3.1 菜单栏扩展</h3>
        <p>扩展应用的状态栏菜单以包含音乐库管理功能：</p>
        <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 状态栏菜单更新</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">setupMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token comment">// 现有菜单项...</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token comment">// 添加音乐库管理子菜单</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> libraryMenu <span class="token operator">=</span> <span class="token class-name">NSMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">let</span> libraryMenuItem <span class="token operator">=</span> <span class="token class-name">NSMenuItem</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"音乐库"</span></span><span class="token punctuation">,</span> comment<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> keyEquivalent<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token comment">// 添加现有音乐库列表</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">for</span> library <span class="token keyword">in</span> libraryManager<span class="token punctuation">.</span>libraries <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token class-name">NSMenuItem</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> library<span class="token punctuation">.</span>name<span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token function">switchLibrary</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keyEquivalent<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">        item<span class="token punctuation">.</span>representedObject <span class="token operator">=</span> library<span class="token punctuation">.</span>id
</span><span class="code-line line-number" line="13">        item<span class="token punctuation">.</span>state <span class="token operator">=</span> libraryManager<span class="token punctuation">.</span>currentLibrary<span class="token operator">?</span><span class="token punctuation">.</span>id <span class="token operator">==</span> library<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">.</span>on <span class="token punctuation">:</span> <span class="token punctuation">.</span>off
</span><span class="code-line line-number" line="14">        libraryMenu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="15">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">    libraryMenu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token class-name">NSMenuItem</span><span class="token punctuation">.</span><span class="token function">separator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="18">    libraryMenu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token class-name">NSMenuItem</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"添加新音乐库"</span></span><span class="token punctuation">,</span> comment<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>addNewLibrary<span class="token punctuation">)</span><span class="token punctuation">,</span> keyEquivalent<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">    <span class="token comment">// 只有当存在多个音乐库时才显示删除选项</span>
</span><span class="code-line line-number" line="21">    <span class="token keyword">if</span> libraryManager<span class="token punctuation">.</span>libraries<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="22">        libraryMenu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token class-name">NSMenuItem</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"删除当前音乐库"</span></span><span class="token punctuation">,</span> comment<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>removeCurrentLibrary<span class="token punctuation">)</span><span class="token punctuation">,</span> keyEquivalent<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="23">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="24">
</span><span class="code-line line-number" line="25">    libraryMenu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token class-name">NSMenuItem</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"重命名当前音乐库"</span></span><span class="token punctuation">,</span> comment<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>renameCurrentLibrary<span class="token punctuation">)</span><span class="token punctuation">,</span> keyEquivalent<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="26">
</span><span class="code-line line-number" line="27">    libraryMenuItem<span class="token punctuation">.</span>submenu <span class="token operator">=</span> libraryMenu
</span><span class="code-line line-number" line="28">    menu<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>libraryMenuItem<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="29">
</span><span class="code-line line-number" line="30">    <span class="token comment">// 其余菜单项...</span>
</span><span class="code-line line-number" line="31"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 状态栏菜单更新
private func setupMenu() {
    // 现有菜单项...

    // 添加音乐库管理子菜单
    let libraryMenu = NSMenu()
    let libraryMenuItem = NSMenuItem(title: NSLocalizedString(&#x22;音乐库&#x22;, comment: &#x22;&#x22;), action: nil, keyEquivalent: &#x22;&#x22;)

    // 添加现有音乐库列表
    for library in libraryManager.libraries {
        let item = NSMenuItem(title: library.name, action: #selector(switchLibrary(_:)), keyEquivalent: &#x22;&#x22;)
        item.representedObject = library.id
        item.state = libraryManager.currentLibrary?.id == library.id ? .on : .off
        libraryMenu.addItem(item)
    }

    libraryMenu.addItem(NSMenuItem.separator())
    libraryMenu.addItem(NSMenuItem(title: NSLocalizedString(&#x22;添加新音乐库&#x22;, comment: &#x22;&#x22;), action: #selector(addNewLibrary), keyEquivalent: &#x22;&#x22;))

    // 只有当存在多个音乐库时才显示删除选项
    if libraryManager.libraries.count > 1 {
        libraryMenu.addItem(NSMenuItem(title: NSLocalizedString(&#x22;删除当前音乐库&#x22;, comment: &#x22;&#x22;), action: #selector(removeCurrentLibrary), keyEquivalent: &#x22;&#x22;))
    }

    libraryMenu.addItem(NSMenuItem(title: NSLocalizedString(&#x22;重命名当前音乐库&#x22;, comment: &#x22;&#x22;), action: #selector(renameCurrentLibrary), keyEquivalent: &#x22;&#x22;))

    libraryMenuItem.submenu = libraryMenu
    menu.addItem(libraryMenuItem)

    // 其余菜单项...
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="32-菜单结构变化"><a aria-hidden="true" tabindex="-1" href="#32-菜单结构变化" class="anchor"><span class="icon icon-link"></span></a>3.2 菜单结构变化</h3>
        <p>下面是菜单栏菜单结构的变化对比：</p>
        <h4 id="原有菜单结构"><a aria-hidden="true" tabindex="-1" href="#原有菜单结构" class="anchor"><span class="icon icon-link"></span></a>原有菜单结构</h4>
        <pre class="language-text"><code class="language-text code-highlight"><span class="code-line line-number" line="1">- 当前播放音乐名称
</span><span class="code-line line-number" line="2">- 播放/暂停
</span><span class="code-line line-number" line="3">- 上一首
</span><span class="code-line line-number" line="4">- 下一首
</span><span class="code-line line-number" line="5">- 播放模式
</span><span class="code-line line-number" line="6">  - 随机
</span><span class="code-line line-number" line="7">  - 单曲循环
</span><span class="code-line line-number" line="8">  - 列表循环
</span><span class="code-line line-number" line="9">- 均衡器
</span><span class="code-line line-number" line="10">  - 启用均衡
</span><span class="code-line line-number" line="11">  - 预设
</span><span class="code-line line-number" line="12">    - 古典
</span><span class="code-line line-number" line="13">    - 流行
</span><span class="code-line line-number" line="14">    - ...
</span><span class="code-line line-number" line="15">  - 低音
</span><span class="code-line line-number" line="16">  - 中音
</span><span class="code-line line-number" line="17">  - 高音
</span><span class="code-line line-number" line="18">- 选择音乐文件夹
</span><span class="code-line line-number" line="19">- 下载音乐
</span><span class="code-line line-number" line="20">- 保持系统唤醒
</span><span class="code-line line-number" line="21">- 开机启动
</span><span class="code-line line-number" line="22">- 退出
</span></code><input type="hidden" value="- 当前播放音乐名称
- 播放/暂停
- 上一首
- 下一首
- 播放模式
  - 随机
  - 单曲循环
  - 列表循环
- 均衡器
  - 启用均衡
  - 预设
    - 古典
    - 流行
    - ...
  - 低音
  - 中音
  - 高音
- 选择音乐文件夹
- 下载音乐
- 保持系统唤醒
- 开机启动
- 退出
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="新菜单结构"><a aria-hidden="true" tabindex="-1" href="#新菜单结构" class="anchor"><span class="icon icon-link"></span></a>新菜单结构</h4>
        <pre class="language-text"><code class="language-text code-highlight"><span class="code-line line-number" line="1">- 当前播放音乐名称
</span><span class="code-line line-number" line="2">- 播放/暂停
</span><span class="code-line line-number" line="3">- 上一首
</span><span class="code-line line-number" line="4">- 下一首
</span><span class="code-line line-number" line="5">- 播放模式
</span><span class="code-line line-number" line="6">  - 随机
</span><span class="code-line line-number" line="7">  - 单曲循环
</span><span class="code-line line-number" line="8">  - 列表循环
</span><span class="code-line line-number" line="9">- 均衡器
</span><span class="code-line line-number" line="10">  - 启用均衡
</span><span class="code-line line-number" line="11">  - 预设
</span><span class="code-line line-number" line="12">    - 古典
</span><span class="code-line line-number" line="13">    - 流行
</span><span class="code-line line-number" line="14">    - ...
</span><span class="code-line line-number" line="15">  - 低音
</span><span class="code-line line-number" line="16">  - 中音
</span><span class="code-line line-number" line="17">  - 高音
</span><span class="code-line line-number" line="18">- **音乐库**
</span><span class="code-line line-number" line="19">  - 音乐库 1 (√) [当前选中的音乐库会有勾选标记]
</span><span class="code-line line-number" line="20">  - 音乐库 2
</span><span class="code-line line-number" line="21">  - 音乐库 3
</span><span class="code-line line-number" line="22">  - ...
</span><span class="code-line line-number" line="23">  - --------- [分隔线]
</span><span class="code-line line-number" line="24">  - 添加新音乐库
</span><span class="code-line line-number" line="25">  - 删除当前音乐库 [仅当有多个音乐库时显示]
</span><span class="code-line line-number" line="26">  - 重命名当前音乐库
</span><span class="code-line line-number" line="27">- 下载音乐
</span><span class="code-line line-number" line="28">- 保持系统唤醒
</span><span class="code-line line-number" line="29">- 开机启动
</span><span class="code-line line-number" line="30">- 退出
</span></code><input type="hidden" value="- 当前播放音乐名称
- 播放/暂停
- 上一首
- 下一首
- 播放模式
  - 随机
  - 单曲循环
  - 列表循环
- 均衡器
  - 启用均衡
  - 预设
    - 古典
    - 流行
    - ...
  - 低音
  - 中音
  - 高音
- **音乐库**
  - 音乐库 1 (√) [当前选中的音乐库会有勾选标记]
  - 音乐库 2
  - 音乐库 3
  - ...
  - --------- [分隔线]
  - 添加新音乐库
  - 删除当前音乐库 [仅当有多个音乐库时显示]
  - 重命名当前音乐库
- 下载音乐
- 保持系统唤醒
- 开机启动
- 退出
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="主要变化"><a aria-hidden="true" tabindex="-1" href="#主要变化" class="anchor"><span class="icon icon-link"></span></a>主要变化</h4>
        <ul>
          <li>将原来的"选择音乐文件夹"菜单项替换为新的"音乐库"子菜单</li>
          <li>"音乐库"子菜单中可以看到所有已添加的音乐库，当前选中的会有勾选标记</li>
          <li>通过子菜单可以快速切换、添加、删除和重命名音乐库</li>
          <li>删除选项仅在存在多个音乐库时才会显示</li>
        </ul>
        <h2 id="4-实现逻辑"><a aria-hidden="true" tabindex="-1" href="#4-实现逻辑" class="anchor"><span class="icon icon-link"></span></a>4. 实现逻辑</h2>
        <h3 id="41-初始化流程"><a aria-hidden="true" tabindex="-1" href="#41-初始化流程" class="anchor"><span class="icon icon-link"></span></a>4.1 初始化流程</h3>
        <ol>
          <li>应用启动时，初始化 LibraryManager</li>
          <li>LibraryManager 加载已保存的音乐库列表</li>
          <li>如果没有已保存的音乐库，创建一个默认音乐库</li>
          <li>加载最近使用的音乐库</li>
        </ol>
        <h3 id="42-添加新音乐库"><a aria-hidden="true" tabindex="-1" href="#42-添加新音乐库" class="anchor"><span class="icon icon-link"></span></a>4.2 添加新音乐库</h3>
        <ol>
          <li>用户从菜单中选择"添加新音乐库"</li>
          <li>打开文件夹选择对话框</li>
          <li>用户选择文件夹并输入库名称</li>
          <li>创建新的 MusicLibrary 对象</li>
          <li>将新库添加到 LibraryManager 中</li>
          <li>保存更新后的库列表</li>
        </ol>
        <h3 id="43-切换音乐库"><a aria-hidden="true" tabindex="-1" href="#43-切换音乐库" class="anchor"><span class="icon icon-link"></span></a>4.3 切换音乐库</h3>
        <ol>
          <li>用户从菜单中选择一个音乐库</li>
          <li>LibraryManager 更新 currentLibrary 和 lastAccessed 时间</li>
          <li>PlayerManager 加载新选中的音乐库的音乐文件</li>
          <li>系统通知用户切换成功</li>
        </ol>
        <h3 id="44-音乐库管理操作"><a aria-hidden="true" tabindex="-1" href="#44-音乐库管理操作" class="anchor"><span class="icon icon-link"></span></a>4.4 音乐库管理操作</h3>
        <ol>
          <li>
            <p><strong>重命名音乐库</strong>：</p>
            <ul>
              <li>用户选择"重命名当前音乐库"</li>
              <li>弹出输入对话框</li>
              <li>用户输入新名称</li>
              <li>更新并保存音乐库信息</li>
            </ul>
          </li>
          <li>
            <p><strong>删除音乐库</strong>：</p>
            <ul>
              <li>用户选择"删除当前音乐库"</li>
              <li>弹出确认对话框</li>
              <li>用户确认后，从列表中移除当前音乐库</li>
              <li>切换到另一个音乐库（如果有）</li>
            </ul>
          </li>
        </ol>
        <h2 id="5-兼容性与迁移"><a aria-hidden="true" tabindex="-1" href="#5-兼容性与迁移" class="anchor"><span class="icon icon-link"></span></a>5. 兼容性与迁移</h2>
        <p>为确保向后兼容性，需要：</p>
        <ol>
          <li>
            <p>迁移现有的单一音乐库</p>
            <pre class="language-swift"><code class="language-swift code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">migrateExistingSingleLibrary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">if</span> <span class="token keyword">let</span> savedPath <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"MusicFolderPath"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">        <span class="token keyword">let</span> defaultLibrary <span class="token operator">=</span> <span class="token class-name">MusicLibrary</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="4">            id<span class="token punctuation">:</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">            name<span class="token punctuation">:</span> <span class="token class-name">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"我的音乐"</span></span><span class="token punctuation">,</span> comment<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">            path<span class="token punctuation">:</span> savedPath<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">            createdAt<span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">            lastAccessed<span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">        <span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">        libraries<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>defaultLibrary<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">        currentLibrary <span class="token operator">=</span> defaultLibrary
</span><span class="code-line line-number" line="13">        <span class="token function">saveLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="private func migrateExistingSingleLibrary() {
    if let savedPath = UserDefaults.standard.string(forKey: &#x22;MusicFolderPath&#x22;) {
        let defaultLibrary = MusicLibrary(
            id: UUID(),
            name: NSLocalizedString(&#x22;我的音乐&#x22;, comment: &#x22;&#x22;),
            path: savedPath,
            createdAt: Date(),
            lastAccessed: Date()
        )

        libraries.append(defaultLibrary)
        currentLibrary = defaultLibrary
        saveLibraries()
    }
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
          </li>
          <li>
            <p>保留对单一音乐库行为的支持</p>
            <ul>
              <li>如果只有一个音乐库，隐藏删除选项</li>
              <li>确保所有现有功能在多库环境中正常工作</li>
            </ul>
          </li>
        </ol>
        <h2 id="6-实现步骤"><a aria-hidden="true" tabindex="-1" href="#6-实现步骤" class="anchor"><span class="icon icon-link"></span></a>6. 实现步骤</h2>
        <h3 id="阶段-1-基础结构实现"><a aria-hidden="true" tabindex="-1" href="#阶段-1-基础结构实现" class="anchor"><span class="icon icon-link"></span></a>阶段 1: 基础结构实现</h3>
        <ol>
          <li>创建 MusicLibrary 模型</li>
          <li>实现 LibraryManager 基本功能</li>
          <li>迁移现有单一音乐库配置</li>
        </ol>
        <h3 id="阶段-2-ui-集成"><a aria-hidden="true" tabindex="-1" href="#阶段-2-ui-集成" class="anchor"><span class="icon icon-link"></span></a>阶段 2: UI 集成</h3>
        <ol>
          <li>扩展状态栏菜单以支持多库管理</li>
          <li>实现基本的库管理功能（添加/删除/切换/重命名）</li>
        </ol>
        <h3 id="阶段-3-测试与优化"><a aria-hidden="true" tabindex="-1" href="#阶段-3-测试与优化" class="anchor"><span class="icon icon-link"></span></a>阶段 3: 测试与优化</h3>
        <ol>
          <li>测试多库环境下的所有功能</li>
          <li>优化性能，特别是大型音乐库的加载时间</li>
          <li>用户体验优化</li>
        </ol>
        <h2 id="7-技术挑战与解决方案"><a aria-hidden="true" tabindex="-1" href="#7-技术挑战与解决方案" class="anchor"><span class="icon icon-link"></span></a>7. 技术挑战与解决方案</h2>
        <h3 id="71-性能考虑"><a aria-hidden="true" tabindex="-1" href="#71-性能考虑" class="anchor"><span class="icon icon-link"></span></a>7.1 性能考虑</h3>
        <p>对于大型音乐库，可能需要考虑：</p>
        <ul>
          <li>异步加载音乐库内容</li>
          <li>实现音乐文件索引和缓存机制</li>
          <li>延迟加载音频资源</li>
        </ul>
        <h3 id="72-用户体验考虑"><a aria-hidden="true" tabindex="-1" href="#72-用户体验考虑" class="anchor"><span class="icon icon-link"></span></a>7.2 用户体验考虑</h3>
        <ul>
          <li>确保在切换音乐库时有明确的视觉反馈</li>
          <li>在菜单中清晰显示当前活动的音乐库</li>
          <li>提供简洁明了的操作流程</li>
        </ul>
        <h2 id="8-未来扩展可能性"><a aria-hidden="true" tabindex="-1" href="#8-未来扩展可能性" class="anchor"><span class="icon icon-link"></span></a>8. 未来扩展可能性</h2>
        <p>本设计为以下未来功能奠定基础：</p>
        <ol>
          <li>智能播放列表：基于音乐库中的歌曲属性自动生成</li>
          <li>跨库播放列表：从多个音乐库中选择歌曲</li>
          <li>云同步：将音乐库配置同步到多设备</li>
          <li>统计信息：跟踪每个音乐库的使用情况和播放统计</li>
        </ol>
        <h2 id="9-结论"><a aria-hidden="true" tabindex="-1" href="#9-结论" class="anchor"><span class="icon icon-link"></span></a>9. 结论</h2>
        <p>多音乐库支持功能将增强 MacMusicPlayer 的用户体验，使用户能够更灵活地组织和享受他们的音乐收藏。通过保持简洁的设计和界面，这一功能可以在不增加复杂性的同时提供更多便利。</p>
      </markdown-style>
    </div>
    <script src="js/demo-preview.js?v=1.34.1"></script>
    <div class="footer warpper" style="max-width:720px;">Copyright © 2025 <a href="https://github.com/samzong" target="_blank">samzong</a><br></div>
    <script src="js/tocbot.js?v=1.34.1"></script>
  </body>
</html>
